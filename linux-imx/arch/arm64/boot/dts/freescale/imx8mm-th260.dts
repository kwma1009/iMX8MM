// SPDX-License-Identifier: GPL-2.0
/*
 * Copyright (C) 2022 PHYTEC Messtechnik GmbH
 * Author: Christian Hemp <c.hemp@phytec.de>
 * Author: Teresa Remmet <t.remmet@phytec.de>
 *
 * Support for TH260 phyCORE-i.MX8MM Testadapter
 */

/dts-v1/;

#include "imx8mm-phycore-som.dtsi"
#include "imx8mm-phyboard-polis.dtsi"

/ {
	model = "PHYTEC TH260 phyCORE-i.MX8MM Testadapter";
	compatible = "phytec,imx8mm-th260", "phytec,imx8mm-phycore-som",
		     "fsl,imx8mm";

	backlight: backlight {
		compatible = "pwm-backlight";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_lcd>;
		default-brightness-level = <6>;
		pwms = <&pwm4 0 50000>;
		enable-gpios = <&gpio5 1 GPIO_ACTIVE_HIGH>;
		brightness-levels= <0 4 8 16 32 64 128 255>;
	};

	display: panel {
		compatible = "edt,etml1010g0dka";
		backlight = <&backlight>;
	};
};

&aips4 {
	csi-upstream@32e20000 {
		compatible = "fsl,imx8mm-csi", "fsl,imx7-csi";
		reg = <0x32e20000 0x1000>;
		interrupts = <GIC_SPI 16 IRQ_TYPE_LEVEL_HIGH>;
		clocks = <&clk IMX8MM_CLK_CSI1_ROOT>;
		clock-names = "mclk";
		dma-coherent;
		status = "okay";

		port {
			csi_up_ep: endpoint {
				remote-endpoint = <&mipi_csi_out_ep>;
			};
		};
	};

	cam0_mipi_csi: mipi-csi-upstream@32e30000 {
		compatible = "fsl,imx8mm-mipi-csi2";
		reg = <0x32e30000 0x1000>;
		interrupts = <GIC_SPI 17 IRQ_TYPE_LEVEL_HIGH>;
		clock-frequency = <500000000>;
		clocks = <&clk IMX8MM_CLK_DISP_APB_ROOT>,
			 <&clk IMX8MM_CLK_CSI1_ROOT>,
			 <&clk IMX8MM_CLK_CSI1_PHY_REF>,
			 <&clk IMX8MM_CLK_DISP_AXI_ROOT>;
		clock-names = "pclk", "wrap", "phy", "axi";
		power-domains = <&mipi_pd>;
		fsl,csis-hs-settle = <9>;
		status = "okay";

		#address-cells = <1>;
		#size-cells = <0>;

		port@0 {
			reg = <0>;
		};

		port@1 {
			reg = <1>;

			mipi_csi_out_ep: endpoint {
				remote-endpoint = <&csi_up_ep>;
			};
		};
	};
};

&csi1_bridge {
	status = "disabled";
};

/*
 * When phy on TH260 is used the IRQ is NC. If the phy is
 * populated on the SoM we can make use of an overlay and
 * set the properties again. As we can not delete anything
 * in overlays the other way around does not work.
 */
&ethphy0 {
	/delete-property/ interrupt-parent;
	/delete-property/ interrupts;
};

&flash0 {
	status = "okay";
};

cam0_i2c: &i2c3 {
	clock-frequency = <400000>;
	pinctrl-names = "default", "gpio";
	pinctrl-0 = <&pinctrl_i2c3>;
	pinctrl-1 = <&pinctrl_i2c3gpio>;
	status = "okay";
};

&lcdif {
        status = "okay";
};

&mipi_csi_1 {
	status = "disabled";
};

&mipi_dsi {
	sync-pol = <1>;
	pwr-delay = <10>;
	status = "okay";
};

&pwm4 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_pwm4>;
	status = "okay";
};

/* FIXME: Needed? */
&sai5 {
	status = "okay";
};

&usdhc2 {
	no-1-8-v;
};

&iomuxc {
	pinctrl_i2c3: i2c3grp {
		fsl,pins = <
			MX8MM_IOMUXC_I2C3_SCL_I2C3_SCL          0x400001c3
			MX8MM_IOMUXC_I2C3_SDA_I2C3_SDA          0x400001c3
		>;
	};

	pinctrl_i2c3gpio: i2c3gpiogrp {
		fsl,pins = <
			MX8MM_IOMUXC_I2C3_SCL_GPIO5_IO18	0x1c3
			MX8MM_IOMUXC_I2C3_SDA_GPIO5_IO19	0x1c3
		>;
	};

	pinctrl_lcd: lcd0grp {
		fsl,pins = <
			MX8MM_IOMUXC_SAI3_TXD_GPIO5_IO1         0x12
		>;
	};

	pinctrl_pwm4: pwm4grp {
		fsl,pins = <
			MX8MM_IOMUXC_SAI3_MCLK_PWM4_OUT		0x12
		>;
	};
};
